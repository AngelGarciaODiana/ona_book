<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>8 Components, Communities and Cliques | Handbook of Graphs and Networks in People Analytics</title>
<meta name="author" content="Keith McNulty">
<meta name="description" content="The study of group dynamics would be pretty ineffective if we were not able to identify and study important subgroups. Networks of people are often made up of subsets that interact more intensely...">
<meta name="generator" content="bookdown 0.22.15 with bs4_book()">
<meta property="og:title" content="8 Components, Communities and Cliques | Handbook of Graphs and Networks in People Analytics">
<meta property="og:type" content="book">
<meta property="og:url" content="https://ona-book.org/community.html">
<meta property="og:image" content="https://ona-book.org/www/cover/cover-ona.png">
<meta property="og:description" content="The study of group dynamics would be pretty ineffective if we were not able to identify and study important subgroups. Networks of people are often made up of subsets that interact more intensely...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="8 Components, Communities and Cliques | Handbook of Graphs and Networks in People Analytics">
<meta name="twitter:site" content="@dr_keithmcnulty">
<meta name="twitter:description" content="The study of group dynamics would be pretty ineffective if we were not able to identify and study important subgroups. Networks of people are often made up of subsets that interact more intensely...">
<meta name="twitter:image" content="https://ona-book.org/www/cover/cover-ona.png">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.9.5/header-attrs.js"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.5.1/tabs.js"></script><script src="libs/bs3compat-0.2.5.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script><link href="libs/vis-4.20.1/vis.css" rel="stylesheet">
<script src="libs/vis-4.20.1/vis.min.js"></script><script src="libs/visNetwork-binding-2.0.9/visNetwork.js"></script><script src="libs/d3-4.5.0/d3.min.js"></script><script src="libs/forceNetwork-binding-0.4/forceNetwork.js"></script><script src="libs/sankey-1/sankey.js"></script><script src="libs/sankeyNetwork-binding-0.4/sankeyNetwork.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><link rel="stylesheet" href="css/style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="With Examples in R and Python">Handbook of Graphs and Networks in People Analytics</a>:
        <small class="text-muted">With Examples in R and Python</small>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Welcome</a></li>
<li><a class="" href="everywhere.html"><span class="header-section-number">1</span> Graphs everywhere!</a></li>
<li><a class="" href="r-intro.html"><span class="header-section-number">2</span> The Basics of the R Programming Language</a></li>
<li><a class="" href="working.html"><span class="header-section-number">3</span> Working With Graphs</a></li>
<li><a class="" href="viz-graphs.html"><span class="header-section-number">4</span> Visualizing Graphs</a></li>
<li><a class="" href="restructuring-data.html"><span class="header-section-number">5</span> Restructuring Data For Use in Graphs</a></li>
<li><a class="" href="paths-distance.html"><span class="header-section-number">6</span> Paths and Distance</a></li>
<li><a class="" href="vertex-importance.html"><span class="header-section-number">7</span> Vertex Importance and Centrality</a></li>
<li><a class="active" href="community.html"><span class="header-section-number">8</span> Components, Communities and Cliques</a></li>
<li><a class="" href="similarity.html"><span class="header-section-number">9</span> Commonality and Assortativity</a></li>
<li><a class="" href="databases.html"><span class="header-section-number">10</span> Graphs as Databases</a></li>
<li><a class="" href="advanced-viz.html"><span class="header-section-number">11</span> Advanced Network Visualization</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/keithmcnulty/ona_book">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="community" class="section level1" number="8">
<h1>
<span class="header-section-number">8</span> Components, Communities and Cliques<a class="anchor" aria-label="anchor" href="#community"><i class="fas fa-link"></i></a>
</h1>
<p>The study of group dynamics would be pretty ineffective if we were not able to identify and study important subgroups. Networks of people are often made up of subsets that interact more intensely among each other than they do with the rest of the network, and it is often very important in research and analysis to identify or approximate these subsets as best as possible so that they can be studied more closely. In complex networks, this is not an easy task. Most of the computational methods we have available to us for finding densely connected subsets of vertices (usually called <em>communities</em>) are iterative approximations which make use of heuristics<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content="&lt;p&gt;Heuristics are methodological ‘shortcuts’ which can vastly reduce the complexity of a problem but usually sacrifice some element of accuracy in doing so.&lt;/p&gt;"><sup>48</sup></a> and are rarely 100% accurate<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content="&lt;p&gt;Many problems of graph ‘clustering’ — that is, finding partitions of a graph that maximise intra-group density but minimize between-group density — have already been shown to be NP-hard&lt;/p&gt;"><sup>49</sup></a>. However, in the study of networks in the organizational sciences, we do not need high levels of precision to be able to draw valuable insights, and therefore these modern approximation techniques are very powerful tools for us to have at our disposal.</p>
<p>In the work we have done thus far in the book, we have already been exposed to subgraphs — we have used induced vertex subgraphs containing a specified set of vertices and all edges between them. However, in these situations we were able to specify the precise subset of vertices that we were interested in. In this chapter we will look at methods to identify or ‘detect’ subsets of vertices based on certain properties of the induced subgraphs of those vertices. We will start with simpler problems such as identifying subsets of vertices which are completely disconnected from others, and then we will proceed to look at graph partitioning and the identification of cliques and communities of vertices which, though not disconnected from other parts of the graph, have higher levels of density between each other than with the rest of the network.</p>
<div id="theory-of-components-partitions-and-clusters" class="section level2" number="8.1">
<h2>
<span class="header-section-number">8.1</span> Theory of components, partitions and clusters<a class="anchor" aria-label="anchor" href="#theory-of-components-partitions-and-clusters"><i class="fas fa-link"></i></a>
</h2>
<div id="connected-components-of-graphs" class="section level3" number="8.1.1">
<h3>
<span class="header-section-number">8.1.1</span> Connected components of graphs<a class="anchor" aria-label="anchor" href="#connected-components-of-graphs"><i class="fas fa-link"></i></a>
</h3>
<p>We learned earlier that a graph <span class="math inline">\(G\)</span> is <strong>connected</strong> if a path exists between any pair of vertices <span class="math inline">\(u\)</span> and <span class="math inline">\(v\)</span> in <span class="math inline">\(G\)</span>. If <span class="math inline">\(G\)</span> is a directed graph, we say <span class="math inline">\(G\)</span> is <strong>weakly connected</strong> if it would be connected when viewed as an undirected graph. We say that <span class="math inline">\(G\)</span> is <strong>strongly connected</strong> if a path exists <em>from</em> <span class="math inline">\(u\)</span> <em>to</em> <span class="math inline">\(v\)</span> for any pair of vertices <span class="math inline">\(u\)</span> and <span class="math inline">\(v\)</span> in <span class="math inline">\(G\)</span>. We say <span class="math inline">\(G\)</span> is <strong>unilaterally connected</strong> if a path exists <em>either</em> from <span class="math inline">\(u\)</span> and <span class="math inline">\(v\)</span> <em>or</em> from <span class="math inline">\(v\)</span> to <span class="math inline">\(u\)</span> for any pair of vertices <span class="math inline">\(u\)</span> and <span class="math inline">\(v\)</span> in <span class="math inline">\(G\)</span>.</p>
<p>A <strong>connected component</strong> of a graph is a connected subset of vertices, none of which are connected to any other vertex in the graph. As an example, the undirected graph in Figure <a href="community.html#fig:component1">8.1</a> consists of three connected components, each with three vertices. In the directed graph in Figure <a href="community.html#fig:component2">8.2</a>, one component is strongly connected (<span class="math inline">\(A \longrightarrow B \longrightarrow C \longrightarrow A\)</span>), one is unilaterally connected (<span class="math inline">\(D \longrightarrow E \longrightarrow F\)</span>) and the third is weakly connected (<span class="math inline">\(G \longrightarrow I \longleftarrow H\)</span>).</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:component1"></span>
<img src="_main_files/figure-html/component1-1.png" alt="A graph with three connected components, each containing three vertices" width="672"><p class="caption">
Figure 8.1: A graph with three connected components, each containing three vertices
</p>
</div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:component2"></span>
<img src="_main_files/figure-html/component2-1.png" alt="A directed graph with three connected components, one strongly connected, one weakly connected and one unilaterallu connected" width="672"><p class="caption">
Figure 8.2: A directed graph with three connected components, one strongly connected, one weakly connected and one unilaterallu connected
</p>
</div>
<p>Connected components of disconnected graphs are important to identify, because many of the measures we have learned so far break down for disconnected graphs. For example, the diameter of a disconnected graph is defined as infinite by mathematical convention, but this is not a useful practical measure. Usually when we want to know the diameter of a graph, we want to understand that largest <em>finite</em> distance between any two vertices, which translates to the diameter of the largest connected component in the graph. Therefore most calculations of diameter in disconnected graphs require us to be able to identify the largest connected component.</p>
<p>It is not too difficult to think of an algorithm that can determine all the connected components of a graph. If you are interested in this see the exercises at the end of this chapter.</p>
<div class="thinkahead">
<p><strong>Playing around</strong>: Go back and try to find some examples in earlier chapters of graphs that are disconnected, and calculate the diameter that is returned by the functions in R or Python packages. For example, you could try the Random Acts of Pizza graph from the exercises at the end of Chapter <a href="viz-graphs.html#viz-graphs">4</a> or the graph of reported friendships from the <code>schoolfriends</code> data set at the end of the previous chapter. What do these functions return?</p>
</div>
</div>
<div id="vertex-partitioning" class="section level3" number="8.1.2">
<h3>
<span class="header-section-number">8.1.2</span> Vertex partitioning<a class="anchor" aria-label="anchor" href="#vertex-partitioning"><i class="fas fa-link"></i></a>
</h3>
<p>Often graphs will be connected but we still want to divide the vertices up into mutually exclusive subgroups of interest. Such a division is called a <strong>partition</strong> of a graph. In a partition, all vertices must be in one and only one subgroup. Partitions are created through making cuts in a graph.</p>
<p>A <strong>cut</strong> in a graph <span class="math inline">\(G\)</span> is a set of edges that divide the vertices of <span class="math inline">\(G\)</span> into two disjoint subsets. The number of edges is known as the size of the cut. In Figure <a href="community.html#fig:cutex">8.3</a>, edges e3, e4 and e5 divide the graph into two disjoint connected sets and represents a cut of size 3.</p>
<p>A <strong>minimum cut</strong> is a cut where no other cut exists in <span class="math inline">\(G\)</span> with a smaller number of edges. In Figure <a href="community.html#fig:cutex">8.3</a>, it should not be difficult to see that mimimum cuts have size 1 can be achieved with either e1 or e2. In both cases these minimum cuts divide the graph into a connected component and an isolate<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content="&lt;p&gt;Maximum cuts are cuts where no other cuts exist with a greater number of edges. Maximum cuts in graphs are extremely challenging. Luckily, we rarely need them in organizational network analysis.&lt;/p&gt;"><sup>50</sup></a>.</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:cutex"></span>
<img src="_main_files/figure-html/cutex-1.png" alt="Cuts are defined by edges that split the vertices of a graph into disjoint subsets" width="672"><p class="caption">
Figure 8.3: Cuts are defined by edges that split the vertices of a graph into disjoint subsets
</p>
</div>
<p>A partition of a graph <span class="math inline">\(G\)</span> is obtained through a series of cuts. For example, if we make a cut using e3, e5 and e7 in Figure <a href="community.html#fig:cutex">8.3</a>, we split the graph into two disjoint connected graphs. If we then make a further cut using e1, we split the graph into three disjoint sets: two disjoint connected sets and an isolate.</p>
<p>In directed graphs, cuts can be defined according to the direction of edges, and in weighted graphs, minimum cuts can be determined through the weights of edges. The most popular algorithm for determining the minimum cut of a graph is the Stoer-Wagner algorithm (<span class="citation"><a href="references.html#ref-stoer" role="doc-biblioref">Stoer and Wagner</a> (<a href="references.html#ref-stoer" role="doc-biblioref">1997</a>)</span>).</p>
</div>
<div id="vertex-clustering-and-community-detection" class="section level3" number="8.1.3">
<h3>
<span class="header-section-number">8.1.3</span> Vertex clustering and community detection<a class="anchor" aria-label="anchor" href="#vertex-clustering-and-community-detection"><i class="fas fa-link"></i></a>
</h3>
<p>Vertex <strong>clustering</strong> refers to the process of partitioning a graph in order to satisfy a certain objective. Most commonly in organizational network analysis, that objective is to achieve a high edge density between the vertices inside a cluster, and a low edge density between vertices that are in different clusters. Such highly connected clusters are usually referred to as communities and the process of determining optimal communities in a graph is knows as <strong>community detection</strong><a class="footnote-ref" tabindex="0" data-toggle="popover" data-content="&lt;p&gt;The meaning of ‘high’ and ‘low’ edge density is relative and really depends on the nature of the graph, and algorithms will do their best to find communities which maximize the difference between in-community density and cross-community density, even though some or all of these communities may not end up having have particularly high edge density&lt;/p&gt;"><sup>51</sup></a>. Community detection is an unsupervised process. When we perform community detection on a graph, we do not know in advance how many communities we seek to find or the size of those communities.</p>
<p>The most commonly used (and fastest) community detection algorithm is the Louvain algorithm. The Louvain algorithm accepts a graph and partitions it into subsets of vertices by trying to maximize the <em>modularity</em> of the graph. Modularity measures how dense the connections are within subsets of vertices in a graph by comparing the density to that which would be expected from a random graph. In an unweighted and undirected graph, modularity takes a value between -0.5 and +1. Any value above zero means that the the vertices inside the subgroups are more densely connected than would be expected by chance. The higher the modularity of a graph, the more connected the vertices are inside the subgroups compared to between the subgroups, and therefore the more certain we can be that the subgroups represent genuine communities. The approximate steps of the Louvain algorithm are in two phases as follows:</p>
<ol style="list-style-type: decimal">
<li>The algorithm starts with each vertex in its own community.</li>
<li>Vertices are moved into other communities and modularity is calculated.<br>
</li>
<li>When the algorithm reaches a point where further vertex moves do not increase modularity, it finishes its first phase.</li>
<li>In the second phase, the communities resulting from the first phase are aggregated to form a simpler pseudograph where each vertex represents a community, where loop edges on a vertex are weighted by the total number of edges inside that community, and where edges between vertices are weighted by the total number of edges between those communities<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content="&lt;p&gt;This also works with weighted edges, assuming that weights represent ‘closeness’ of connection, which they usually do in organizational contexts.&lt;/p&gt;"><sup>52</sup></a>. In this heuristic step, vertices are moved in this simpler graph with the aim of improving modularity. That is, communities may be combined if modularity is improved.</li>
<li>Phases 1 and 2 are repeated until modularity cannot be further improved.</li>
</ol>
<p>A more recently developed community detection algorithm which improves on the Louvain algorithm is the Leiden algorithm. The Leiden algorithm operates similarly to Louvain, but has an additional refinement process at the end of the first phase which helps increase the options for improved modularity in the second phase. The Leiden algorithm will always achieve results as good as the Louvain algorithm, and in many cases may detect communities which are better connected than those detected by Louvain.</p>
<p>Both the Louvain and Leiden algorithms are good options for performing community detection in an organizational context. However, there are numerous other options, many of which are available in common data science packages. For example, the Girvan-Newman algorithm operates in a very different way by starting with an entire graph and progressively removing important edges to potentially reveal high modularity subgroups. For more detailed reference on the Louvain and Leiden algorithms see <span class="citation"><a href="references.html#ref-traag" role="doc-biblioref">Traag, Waltman, and Eck</a> (<a href="references.html#ref-traag" role="doc-biblioref">2019</a>)</span> and for more general insight into a broader range of community detection algorithms, see <span class="citation"><a href="references.html#ref-yang" role="doc-biblioref">Yang, Algesheimer, and Tessone</a> (<a href="references.html#ref-yang" role="doc-biblioref">2016</a>)</span>.</p>
<p>One important aspect of community detection which is often not understood is that community detection algorithms classify vertices into subgroups, but offer no direct insight into the <em>nature</em> of those subgroups. Further analytic techniques need to be applied to help describe the subgroups in a meaningful way. For example, the subgroups could be compared to known characteristics of the network (such as department in the <code>workfrance</code> graph or class in the <code>schoolfriends</code> graph). We will examine this using an example later in this chapter.</p>
</div>
<div id="cliques" class="section level3" number="8.1.4">
<h3>
<span class="header-section-number">8.1.4</span> Cliques<a class="anchor" aria-label="anchor" href="#cliques"><i class="fas fa-link"></i></a>
</h3>
<p>A <strong>clique</strong> is a subset of vertices in an undirected graph whose induced subgraph is complete. That is, the induced subgraph has an edge density of 1. This is best understood as the most intense possible type of community in an undirected graph. A <strong>maximal clique</strong> is a clique which cannot be extended by adding another vertex. A <strong>largest clique</strong> is a clique with the greatest number of vertices of all cliques in the graph.</p>
<p>In Figure <a href="community.html#fig:cutex">8.3</a>, the following are maximal cliques: <span class="math inline">\(B \longleftrightarrow C\)</span>, <span class="math inline">\(A \longleftrightarrow C\)</span>, <span class="math inline">\(C \longleftrightarrow E \longleftrightarrow F\)</span> and <span class="math inline">\(C \longleftrightarrow D \longleftrightarrow F\)</span> because no other vertex can be added to these cliques without creating an incomplete graph. <span class="math inline">\(C \longleftrightarrow E \longleftrightarrow F\)</span> and <span class="math inline">\(C \longleftrightarrow D \longleftrightarrow F\)</span> are largest cliques because there is no other clique in the graph that has more than three vertices.</p>
<p>Finding a single maximal clique in an undirected graph is not a complex problem and can be done quickly using a standard search algorithm starting on an arbitrary vertex. However, finding maximal cliques of a specified size, or all maximal cliques, as well as finding largest cliques, are problems whose complexity increases with the size and density of a graph. Care should be taken in attempting these algorithms on very large graphs.</p>
<div class="thinkahead">
<p><strong>Thinking ahead:</strong> Go back to the graph of <em>Zachary’s Karate Club</em> in Chapter <a href="viz-graphs.html#viz-graphs">4</a>. Can you identify some maximal cliques? What do you think is the size of the largest clique? Thinking about this will give you a sense of how hard the largest clique problem might be on very large graphs. We will use this as an example later in the chapter.</p>
</div>
</div>
</div>
<div id="finding-components-communities-and-cliques-using-r" class="section level2" number="8.2">
<h2>
<span class="header-section-number">8.2</span> Finding components, communities and cliques using R<a class="anchor" aria-label="anchor" href="#finding-components-communities-and-cliques-using-r"><i class="fas fa-link"></i></a>
</h2>
<div id="finding-connected-components-of-disconnected-graphs" class="section level3" number="8.2.1">
<h3>
<span class="header-section-number">8.2.1</span> Finding connected components of disconnected graphs<a class="anchor" aria-label="anchor" href="#finding-connected-components-of-disconnected-graphs"><i class="fas fa-link"></i></a>
</h3>
<p>To illustrate the <code><a href="https://rdrr.io/pkg/igraph/man/components.html">components()</a></code> function in <code>igraph</code> we will load up the <code>schoolfriends</code> edgelist dataset from an earlier chapter. We will use reported friendships, create a directed graph and visualize it.</p>
<div class="sourceCode" id="cb419"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://igraph.org">igraph</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggraph.data-imaginist.com">ggraph</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>

<span class="co"># get schoolfriends edgelist</span>
<span class="va">schoolfriends_edgelist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"https://ona-book.org/data/schoolfriends_edgelist.csv"</span><span class="op">)</span>

<span class="co"># just use reported friendships</span>
<span class="va">schoolfriends_reported</span> <span class="op">&lt;-</span> <span class="va">schoolfriends_edgelist</span> |&gt; 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">type</span> <span class="op">==</span> <span class="st">"reported"</span><span class="op">)</span>

<span class="co"># create directed graph</span>
<span class="va">schoolfriends_rp</span> <span class="op">&lt;-</span> <span class="fu">igraph</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/igraph/man/graph_from_data_frame.html">graph_from_data_frame</a></span><span class="op">(</span><span class="va">schoolfriends_reported</span><span class="op">)</span>

<span class="co"># visualize</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span>
<span class="fu"><a href="https://ggraph.data-imaginist.com/reference/ggraph.html">ggraph</a></span><span class="op">(</span><span class="va">schoolfriends_rp</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_edge_link.html">geom_edge_link</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"grey"</span>, alpha <span class="op">=</span> <span class="fl">0.7</span>, 
                 arrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/arrow.html">arrow</a></span><span class="op">(</span>length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="st">"cm"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_node_point.html">geom_node_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span>, color <span class="op">=</span> <span class="st">"lightblue"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_void</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-207-1.png" width="672"></div>
<p>We can see some connected components in this disconnected graph. We can use the <code><a href="https://rdrr.io/pkg/igraph/man/components.html">components()</a></code> function to classify the vertices into the connected components. This function generates a list containing the following vectors:</p>
<ul>
<li>
<code>membership</code>, which is a vector assigning each vertex to a numbered component</li>
<li>
<code>csize</code>, which returns the size of each component</li>
<li>
<code>no</code>, which is the number of connected components</li>
</ul>
<p>Let’s verify the latter two:</p>
<div class="sourceCode" id="cb420"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># get weakly connected components (mode ignored if undirected)</span>
<span class="va">schoolfriends_components</span> <span class="op">&lt;-</span> <span class="fu">igraph</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/igraph/man/components.html">components</a></span><span class="op">(</span><span class="va">schoolfriends_rp</span>, 
                                               mode <span class="op">=</span> <span class="st">"weak"</span><span class="op">)</span>

<span class="co"># how many components?</span>
<span class="va">schoolfriends_components</span><span class="op">$</span><span class="va">no</span></code></pre></div>
<pre><code>## [1] 3</code></pre>
<div class="sourceCode" id="cb422"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># size of components</span>
<span class="va">schoolfriends_components</span><span class="op">$</span><span class="va">csize</span></code></pre></div>
<pre><code>## [1] 128   3   3</code></pre>
<p>We can use the membership to assign a <code>component</code> property and then visualize with the vertices colored by component, as in Figure <a href="community.html#fig:component-color">8.4</a>.</p>
<div class="sourceCode" id="cb424"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># assign component property</span>
<span class="fu"><a href="https://rdrr.io/pkg/igraph/man/V.html">V</a></span><span class="op">(</span><span class="va">schoolfriends_rp</span><span class="op">)</span><span class="op">$</span><span class="va">component</span> <span class="op">&lt;-</span> <span class="va">schoolfriends_components</span><span class="op">$</span><span class="va">membership</span>

<span class="co"># visualize</span>
<span class="fu"><a href="https://ggraph.data-imaginist.com/reference/ggraph.html">ggraph</a></span><span class="op">(</span><span class="va">schoolfriends_rp</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_edge_link.html">geom_edge_link</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"grey"</span>, alpha <span class="op">=</span> <span class="fl">0.7</span>, 
                 arrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/arrow.html">arrow</a></span><span class="op">(</span>length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="st">"cm"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_node_point.html">geom_node_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">component</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"Component"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_void</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:component-color"></span>
<img src="_main_files/figure-html/component-color-1.png" alt="The reported `schoolfriends` graph color coded by its (weakly) connected components" width="672"><p class="caption">
Figure 8.4: The reported <code>schoolfriends</code> graph color coded by its (weakly) connected components
</p>
</div>
<div class="thinkahead">
<p><strong>Playing around:</strong> Weakly connected components of a directed graph are easier to spot with the naked eye compared to strongly connected components. Why? Remind yourself of the definition of weakly connected from earlier in this chapter. Try to repeat this analysis to visualize all strongly connected components in the reported <code>schoolfriends</code>graph and see the difference.</p>
</div>
</div>
<div id="partioning-and-community-detection-in-r" class="section level3" number="8.2.2">
<h3>
<span class="header-section-number">8.2.2</span> Partioning and community detection in R<a class="anchor" aria-label="anchor" href="#partioning-and-community-detection-in-r"><i class="fas fa-link"></i></a>
</h3>
<p>For the next few examples we will return to <em>Zachary’s Karate Club</em> network from Chapter <a href="viz-graphs.html#viz-graphs">4</a>. Let’s load up and visualize that directed graph and mark the known leading actors Mr Hi and John A with larger vertices, as in Figure <a href="community.html#fig:karate8">8.5</a>.</p>
<div class="sourceCode" id="cb425"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># get karate edgelist</span>
<span class="va">karate_edges</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"https://ona-book.org/data/karate.csv"</span><span class="op">)</span>

<span class="co"># create undirected graph</span>
<span class="va">karate</span> <span class="op">&lt;-</span> <span class="fu">igraph</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/igraph/man/graph_from_data_frame.html">graph_from_data_frame</a></span><span class="op">(</span><span class="va">karate_edges</span>, directed <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>

<span class="co"># color John A and Mr Hi differently</span>
<span class="fu"><a href="https://rdrr.io/pkg/igraph/man/V.html">V</a></span><span class="op">(</span><span class="va">karate</span><span class="op">)</span><span class="op">$</span><span class="va">leader</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/igraph/man/V.html">V</a></span><span class="op">(</span><span class="va">karate</span><span class="op">)</span><span class="op">$</span><span class="va">name</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Mr Hi"</span>, <span class="st">"John A"</span><span class="op">)</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>

<span class="co"># visualize</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span>
<span class="fu"><a href="https://ggraph.data-imaginist.com/reference/ggraph.html">ggraph</a></span><span class="op">(</span><span class="va">karate</span>, layout <span class="op">=</span> <span class="st">"fr"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_edge_link.html">geom_edge_link</a></span><span class="op">(</span>color <span class="op">=</span>  <span class="st">"grey"</span>, alpha <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_node_point.html">geom_node_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">leader</span><span class="op">)</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"lightblue"</span>,
                  show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_void</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:karate8"></span>
<img src="_main_files/figure-html/karate8-1.png" alt="The `karate` graph with Mr Hi and John A indicated with larger vertices" width="672"><p class="caption">
Figure 8.5: The <code>karate</code> graph with Mr Hi and John A indicated with larger vertices
</p>
</div>
<p>Minimum cuts in graphs can be found using the <code><a href="https://rdrr.io/pkg/igraph/man/min_cut.html">min_cut()</a></code> function in <code>igraph</code>. This will return the number of edges in the minimum cut, unless you use the <code>value.only = FALSE</code> argument, in which case it will return more information on the cut,</p>
<div class="sourceCode" id="cb426"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">igraph</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/igraph/man/min_cut.html">min_cut</a></span><span class="op">(</span><span class="va">karate</span>, value.only <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<pre><code>## $value
## [1] 1
## 
## $cut
## + 1/78 edge from e28063e (vertex names):
## [1] Mr Hi--Actor 12
## 
## $partition1
## + 1/34 vertex, named, from e28063e:
## [1] Actor 12
## 
## $partition2
## + 33/34 vertices, named, from e28063e:
##  [1] Mr Hi    Actor 2  Actor 3  Actor 4  Actor 5  Actor 6  Actor 7  Actor 9  Actor 10 Actor 14 Actor 15 Actor 16 Actor 19
## [14] Actor 20 Actor 21 Actor 23 Actor 24 Actor 25 Actor 26 Actor 27 Actor 28 Actor 29 Actor 30 Actor 31 Actor 32 Actor 33
## [27] Actor 8  Actor 11 Actor 13 Actor 18 Actor 22 Actor 17 John A</code></pre>
<p>We see that a minimum cut exists of size 1 between Mr Hi and Actor 12.</p>
<p>The Louvain community detection algorithm can be run using the <code><a href="https://rdrr.io/pkg/igraph/man/cluster_louvain.html">cluster_louvain()</a></code> function. <code>weights</code> can be added as an argument, or will be used by default if the graph has a <code>weight</code> edge attribute (set <code>weight = NA</code> to avoid this). This will produce a list of community groups. The best way to record the resulting community membership is to assign it as a vertex property using the <code><a href="https://rdrr.io/pkg/igraph/man/communities.html">membership()</a></code> function.</p>
<div class="sourceCode" id="cb428"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># detect communities using Louvain</span>
<span class="va">communities</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/igraph/man/cluster_louvain.html">cluster_louvain</a></span><span class="op">(</span><span class="va">karate</span><span class="op">)</span>

<span class="co"># assign as a vertex property</span>
<span class="fu"><a href="https://rdrr.io/pkg/igraph/man/V.html">V</a></span><span class="op">(</span><span class="va">karate</span><span class="op">)</span><span class="op">$</span><span class="va">community</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/igraph/man/communities.html">membership</a></span><span class="op">(</span><span class="va">communities</span><span class="op">)</span></code></pre></div>
<p>Before visualizing the communities, we can see how many they are and their size<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content="&lt;p&gt;We can also see the modularity of the partition by calling the &lt;code&gt;modularity()&lt;/code&gt; function.&lt;/p&gt;"><sup>53</sup></a>:</p>
<div class="sourceCode" id="cb429"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/igraph/man/communities.html">sizes</a></span><span class="op">(</span><span class="va">communities</span><span class="op">)</span></code></pre></div>
<pre><code>## Community sizes
##  1  2  3  4 
##  6 12 11  5</code></pre>
<p>We have four detected communities of varying sizes. As before, we can color code to visualize these, as in Figure <a href="community.html#fig:karate-communities">8.6</a>.</p>
<div class="sourceCode" id="cb431"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span>
<span class="fu"><a href="https://ggraph.data-imaginist.com/reference/ggraph.html">ggraph</a></span><span class="op">(</span><span class="va">karate</span>, layout <span class="op">=</span> <span class="st">"fr"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_edge_link.html">geom_edge_link</a></span><span class="op">(</span>color <span class="op">=</span>  <span class="st">"grey"</span>, alpha <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggraph.data-imaginist.com/reference/geom_node_point.html">geom_node_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">leader</span><span class="op">)</span>, color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">community</span><span class="op">)</span><span class="op">)</span>,
                  show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_void</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:karate-communities"></span>
<img src="_main_files/figure-html/karate-communities-1.png" alt="Communities of the `karate` graph as detected by the Louvain algorithm" width="672"><p class="caption">
Figure 8.6: Communities of the <code>karate</code> graph as detected by the Louvain algorithm
</p>
</div>
<div class="thinkahead">
<p><strong>Playing around:</strong>. Try playing around with some of the other community detection methods available in <code>igraph</code> using the <code>karate</code> example. How different are the results? For example, try <code><a href="https://rdrr.io/pkg/igraph/man/cluster_edge_betweenness.html">cluster_edge_betweenness()</a></code> (the Girvan-Newman algorithm) or <code><a href="https://rdrr.io/pkg/igraph/man/cluster_infomap.html">cluster_infomap()</a></code> or any other methods that begin with <code>cluster</code>.</p>
</div>
</div>
<div id="finding-cliques-in-r" class="section level3" number="8.2.3">
<h3>
<span class="header-section-number">8.2.3</span> Finding cliques in R<a class="anchor" aria-label="anchor" href="#finding-cliques-in-r"><i class="fas fa-link"></i></a>
</h3>
<p>The <code><a href="https://rdrr.io/pkg/igraph/man/cliques.html">cliques()</a></code> and <code><a href="https://rdrr.io/pkg/igraph/man/cliques.html">max_cliques()</a></code> function in <code>igraph</code> identifies all cliques or maximal cliques respectively, with a specified maximum or minimum size if desired. It is advisable to specify a size for cliques of interest because otherwise a long list might be returned, including many single node cliques.</p>
<div class="sourceCode" id="cb432"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/igraph/man/cliques.html">max_cliques</a></span><span class="op">(</span><span class="va">karate</span>, min <span class="op">=</span> <span class="fl">5</span>, max <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></code></pre></div>
<pre><code>## [[1]]
## + 5/34 vertices, named, from e28063e:
## [1] Actor 2  Mr Hi    Actor 4  Actor 3  Actor 14
## 
## [[2]]
## + 5/34 vertices, named, from e28063e:
## [1] Actor 2 Mr Hi   Actor 4 Actor 3 Actor 8</code></pre>
<p>The <code><a href="https://rdrr.io/pkg/igraph/man/cliques.html">largest_cliques()</a></code> finds all largest cliques in a graph.</p>
<div class="sourceCode" id="cb434"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/igraph/man/cliques.html">largest_cliques</a></span><span class="op">(</span><span class="va">karate</span><span class="op">)</span></code></pre></div>
<pre><code>## [[1]]
## + 5/34 vertices, named, from e28063e:
## [1] Actor 8 Mr Hi   Actor 2 Actor 3 Actor 4
## 
## [[2]]
## + 5/34 vertices, named, from e28063e:
## [1] Actor 4  Mr Hi    Actor 2  Actor 3  Actor 14</code></pre>
<p>We see that the maximal cliques of size 5 that we identified are also the largest cliques in the <code>karate graph</code>, and they have four out of 5 vertices in common. The function <code><a href="https://rdrr.io/pkg/igraph/man/cliques.html">clique_num()</a></code> returns the size of the largest clique.</p>
<div class="sourceCode" id="cb436"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/igraph/man/cliques.html">clique_num</a></span><span class="op">(</span><span class="va">karate</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 5</code></pre>
</div>
</div>
<div id="finding-components-communities-and-cliques-using-python" class="section level2" number="8.3">
<h2>
<span class="header-section-number">8.3</span> Finding components, communities and cliques using Python<a class="anchor" aria-label="anchor" href="#finding-components-communities-and-cliques-using-python"><i class="fas fa-link"></i></a>
</h2>
<div id="finding-components-using-python" class="section level3" number="8.3.1">
<h3>
<span class="header-section-number">8.3.1</span> Finding components using Python<a class="anchor" aria-label="anchor" href="#finding-components-using-python"><i class="fas fa-link"></i></a>
</h3>
<p>For <em>undirected graphs</em>, the <code>networkx</code> function <code>number_connected_components()</code> returns the number of connected components in the graph while the <code>connected_components()</code> function returns the vertices in each connected component.</p>
<p>For <em>directed graphs</em>, the similar functions identify weakly and strongly connected components. Let’s use the reported friendships from the <code>schoolfriends</code> data set as an example.</p>
<div class="sourceCode" id="cb438"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb438-1"><a href="community.html#cb438-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb438-2"><a href="community.html#cb438-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> networkx <span class="im">as</span> nx</span>
<span id="cb438-3"><a href="community.html#cb438-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb438-4"><a href="community.html#cb438-4" aria-hidden="true" tabindex="-1"></a><span class="co"># get schoolfriends edgelist</span></span>
<span id="cb438-5"><a href="community.html#cb438-5" aria-hidden="true" tabindex="-1"></a>schoolfriends_edges <span class="op">=</span> pd.read_csv(<span class="st">"https://ona-book.org/data/schoolfriends_edgelist.csv"</span>)</span>
<span id="cb438-6"><a href="community.html#cb438-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb438-7"><a href="community.html#cb438-7" aria-hidden="true" tabindex="-1"></a><span class="co"># use only reported friendships</span></span>
<span id="cb438-8"><a href="community.html#cb438-8" aria-hidden="true" tabindex="-1"></a>schoolfriends_reported <span class="op">=</span> schoolfriends_edges[schoolfriends_edges.<span class="bu">type</span> <span class="op">==</span> <span class="st">"reported"</span>]</span>
<span id="cb438-9"><a href="community.html#cb438-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb438-10"><a href="community.html#cb438-10" aria-hidden="true" tabindex="-1"></a><span class="co"># create directed graph</span></span>
<span id="cb438-11"><a href="community.html#cb438-11" aria-hidden="true" tabindex="-1"></a>schoolfriends_rp <span class="op">=</span> nx.from_pandas_edgelist(</span>
<span id="cb438-12"><a href="community.html#cb438-12" aria-hidden="true" tabindex="-1"></a>  schoolfriends_reported,</span>
<span id="cb438-13"><a href="community.html#cb438-13" aria-hidden="true" tabindex="-1"></a>  source <span class="op">=</span> <span class="st">"from"</span>,</span>
<span id="cb438-14"><a href="community.html#cb438-14" aria-hidden="true" tabindex="-1"></a>  target <span class="op">=</span> <span class="st">"to"</span>,</span>
<span id="cb438-15"><a href="community.html#cb438-15" aria-hidden="true" tabindex="-1"></a>  create_using<span class="op">=</span>nx.DiGraph</span>
<span id="cb438-16"><a href="community.html#cb438-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb438-17"><a href="community.html#cb438-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb438-18"><a href="community.html#cb438-18" aria-hidden="true" tabindex="-1"></a><span class="co"># number of weakly connected components</span></span>
<span id="cb438-19"><a href="community.html#cb438-19" aria-hidden="true" tabindex="-1"></a>nx.number_weakly_connected_components(schoolfriends_rp)</span></code></pre></div>
<pre><code>## 3</code></pre>
<div class="sourceCode" id="cb440"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb440-1"><a href="community.html#cb440-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create component subgraphs </span></span>
<span id="cb440-2"><a href="community.html#cb440-2" aria-hidden="true" tabindex="-1"></a>components <span class="op">=</span> nx.weakly_connected_components(schoolfriends_rp)</span>
<span id="cb440-3"><a href="community.html#cb440-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb440-4"><a href="community.html#cb440-4" aria-hidden="true" tabindex="-1"></a>subgraphs <span class="op">=</span> [schoolfriends_rp.subgraph(component).copy() </span>
<span id="cb440-5"><a href="community.html#cb440-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> component <span class="kw">in</span> components]</span>
<span id="cb440-6"><a href="community.html#cb440-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb440-7"><a href="community.html#cb440-7" aria-hidden="true" tabindex="-1"></a><span class="co"># size of subgraphs</span></span>
<span id="cb440-8"><a href="community.html#cb440-8" aria-hidden="true" tabindex="-1"></a>[<span class="bu">len</span>(subgraph.nodes) <span class="cf">for</span> subgraph <span class="kw">in</span> subgraphs]</span></code></pre></div>
<pre><code>## [128, 3, 3]</code></pre>
<div class="sourceCode" id="cb442"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb442-1"><a href="community.html#cb442-1" aria-hidden="true" tabindex="-1"></a><span class="co"># view nodes in one of the smaller components</span></span>
<span id="cb442-2"><a href="community.html#cb442-2" aria-hidden="true" tabindex="-1"></a>subgraphs[<span class="dv">2</span>].nodes</span></code></pre></div>
<pre><code>## NodeView((366, 1485, 974))</code></pre>
</div>
<div id="partitioning-and-community-detection-using-python" class="section level3" number="8.3.2">
<h3>
<span class="header-section-number">8.3.2</span> Partitioning and community detection using Python<a class="anchor" aria-label="anchor" href="#partitioning-and-community-detection-using-python"><i class="fas fa-link"></i></a>
</h3>
<p><code>networkx</code> has numerous algorithmic functions for exploring edge cuts on graphs, including to find the minimum edge cut. You can consult the reference documentation<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="https://networkx.org/documentation/stable/reference/algorithms/cuts.html" class="uri"&gt;https://networkx.org/documentation/stable/reference/algorithms/cuts.html&lt;/a&gt;&lt;/p&gt;'><sup>54</sup></a> to learn about the various functions available. Let’s use the <code>karate</code> dataset to demonstrate how to find a minimum cut.</p>
<div class="sourceCode" id="cb444"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb444-1"><a href="community.html#cb444-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get karate edgelist</span></span>
<span id="cb444-2"><a href="community.html#cb444-2" aria-hidden="true" tabindex="-1"></a>karate_edges <span class="op">=</span> pd.read_csv(<span class="st">"https://ona-book.org/data/karate.csv"</span>)</span>
<span id="cb444-3"><a href="community.html#cb444-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb444-4"><a href="community.html#cb444-4" aria-hidden="true" tabindex="-1"></a><span class="co"># create undirected network</span></span>
<span id="cb444-5"><a href="community.html#cb444-5" aria-hidden="true" tabindex="-1"></a>karate <span class="op">=</span> nx.from_pandas_edgelist(karate_edges, source <span class="op">=</span> <span class="st">"from"</span>, target <span class="op">=</span> <span class="st">"to"</span>)</span>
<span id="cb444-6"><a href="community.html#cb444-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb444-7"><a href="community.html#cb444-7" aria-hidden="true" tabindex="-1"></a><span class="co"># find minimum cut</span></span>
<span id="cb444-8"><a href="community.html#cb444-8" aria-hidden="true" tabindex="-1"></a>nx.minimum_edge_cut(karate)</span></code></pre></div>
<pre><code>## {('Actor 12', 'Mr Hi')}</code></pre>
<div class="sourceCode" id="cb446"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb446-1"><a href="community.html#cb446-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get minimum edge cut size</span></span>
<span id="cb446-2"><a href="community.html#cb446-2" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(nx.minimum_edge_cut(karate))</span></code></pre></div>
<pre><code>## 1</code></pre>
<p>Various built-in community detection algorithms are available in the the <code>networkx.community</code> module, such as the Girvan-Newman edge betweenness algorithm. This generates communities by progressively removing edges with the highest edge betweenness centrality. It returns an iterator object where the first element is the result of the first edge removal, and subsequent elements are the result of progressive edge removal.</p>
<div class="sourceCode" id="cb448"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb448-1"><a href="community.html#cb448-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get communities based on girvan-newman and sort according to no of communities</span></span>
<span id="cb448-2"><a href="community.html#cb448-2" aria-hidden="true" tabindex="-1"></a>communities <span class="op">=</span> <span class="bu">sorted</span>(</span>
<span id="cb448-3"><a href="community.html#cb448-3" aria-hidden="true" tabindex="-1"></a>  nx.community.girvan_newman(karate), </span>
<span id="cb448-4"><a href="community.html#cb448-4" aria-hidden="true" tabindex="-1"></a>  key <span class="op">=</span> <span class="bu">len</span></span>
<span id="cb448-5"><a href="community.html#cb448-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb448-6"><a href="community.html#cb448-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb448-7"><a href="community.html#cb448-7" aria-hidden="true" tabindex="-1"></a><span class="co"># view communities from first edge removal</span></span>
<span id="cb448-8"><a href="community.html#cb448-8" aria-hidden="true" tabindex="-1"></a>communities[<span class="dv">0</span>]</span></code></pre></div>
<pre><code>## ({'Actor 8', 'Actor 20', 'Actor 22', 'Actor 18', 'Actor 5', 'Actor 14', 'Mr Hi', 'Actor 11', 'Actor 4', 'Actor 6', 'Actor 17', 'Actor 7', 'Actor 13', 'Actor 2', 'Actor 12'}, {'Actor 33', 'Actor 21', 'John A', 'Actor 15', 'Actor 10', 'Actor 9', 'Actor 25', 'Actor 30', 'Actor 32', 'Actor 16', 'Actor 23', 'Actor 26', 'Actor 29', 'Actor 19', 'Actor 31', 'Actor 3', 'Actor 27', 'Actor 24', 'Actor 28'})</code></pre>
<p>We see that the first split leads to two communities, one around John A and the other around Mr Hi.</p>
<p>The <code>cdlib</code> package in Python contains a very wide range of community detection algorithms that work with the <code>networkx</code> package, including the Louvain and Leiden algorithms as well as many others. In this example we create a Louvain partition of the <code>karate</code> graph using <code>cdlib</code>.</p>
<div class="sourceCode" id="cb450"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb450-1"><a href="community.html#cb450-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> cdlib <span class="im">import</span> algorithms</span>
<span id="cb450-2"><a href="community.html#cb450-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb450-3"><a href="community.html#cb450-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.cm <span class="im">as</span> cm</span>
<span id="cb450-4"><a href="community.html#cb450-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt </span>
<span id="cb450-5"><a href="community.html#cb450-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb450-6"><a href="community.html#cb450-6" aria-hidden="true" tabindex="-1"></a><span class="co"># get louvain partition which optimizes modularity</span></span>
<span id="cb450-7"><a href="community.html#cb450-7" aria-hidden="true" tabindex="-1"></a>louvain_comms <span class="op">=</span> algorithms.louvain(karate)</span></code></pre></div>
<p><code>louvain_comms</code> is a clustering object that has a lot of useful properties and methods. To see the communities:</p>
<div class="sourceCode" id="cb451"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb451-1"><a href="community.html#cb451-1" aria-hidden="true" tabindex="-1"></a>louvain_comms.communities</span></code></pre></div>
<pre><code>## [['Mr Hi', 'Actor 2', 'Actor 3', 'Actor 4', 'Actor 8', 'Actor 12', 'Actor 13', 'Actor 14', 'Actor 18', 'Actor 20', 'Actor 22', 'Actor 10'], ['Actor 9', 'Actor 31', 'Actor 33', 'John A', 'Actor 15', 'Actor 16', 'Actor 19', 'Actor 21', 'Actor 23', 'Actor 30', 'Actor 27'], ['Actor 32', 'Actor 28', 'Actor 29', 'Actor 24', 'Actor 26', 'Actor 25'], ['Actor 5', 'Actor 6', 'Actor 7', 'Actor 11', 'Actor 17']]</code></pre>
<p>We see four communities. The modularity of the resulting community structure can be calculated using the <code>newman_girvan_modularity()</code> method.</p>
<div class="sourceCode" id="cb453"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb453-1"><a href="community.html#cb453-1" aria-hidden="true" tabindex="-1"></a>louvain_comms.newman_girvan_modularity()</span></code></pre></div>
<pre><code>## FitnessResult(min=None, max=None, score=0.4188034188034188, std=None)</code></pre>
<p>To visualize the network community structure, we can create a color mapping against the communities, as in Figure <a href="community.html#fig:karate-py-conn">8.7</a>.</p>
<div class="sourceCode" id="cb455"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb455-1"><a href="community.html#cb455-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb455-2"><a href="community.html#cb455-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib <span class="im">import</span> cm</span>
<span id="cb455-3"><a href="community.html#cb455-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib.colors <span class="im">import</span> ListedColormap, LinearSegmentedColormap</span>
<span id="cb455-4"><a href="community.html#cb455-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb455-5"><a href="community.html#cb455-5" aria-hidden="true" tabindex="-1"></a><span class="co"># create dict with labels only for Mr Hi and John A</span></span>
<span id="cb455-6"><a href="community.html#cb455-6" aria-hidden="true" tabindex="-1"></a>node <span class="op">=</span> <span class="bu">list</span>(karate.nodes)</span>
<span id="cb455-7"><a href="community.html#cb455-7" aria-hidden="true" tabindex="-1"></a>labels <span class="op">=</span> [i <span class="cf">if</span> i <span class="op">==</span> <span class="st">"Mr Hi"</span> <span class="kw">or</span> i <span class="op">==</span> <span class="st">"John A"</span> <span class="cf">else</span> <span class="st">""</span> <span class="cf">for</span> i <span class="kw">in</span> karate.nodes]</span>
<span id="cb455-8"><a href="community.html#cb455-8" aria-hidden="true" tabindex="-1"></a>nodelabels <span class="op">=</span> <span class="bu">dict</span>(<span class="bu">zip</span>(node, labels))</span>
<span id="cb455-9"><a href="community.html#cb455-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb455-10"><a href="community.html#cb455-10" aria-hidden="true" tabindex="-1"></a><span class="co"># create and order community mappings</span></span>
<span id="cb455-11"><a href="community.html#cb455-11" aria-hidden="true" tabindex="-1"></a>communities <span class="op">=</span> louvain_comms.to_node_community_map()</span>
<span id="cb455-12"><a href="community.html#cb455-12" aria-hidden="true" tabindex="-1"></a>communities <span class="op">=</span> [communities[k].pop() <span class="cf">for</span> k <span class="kw">in</span> node]</span>
<span id="cb455-13"><a href="community.html#cb455-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb455-14"><a href="community.html#cb455-14" aria-hidden="true" tabindex="-1"></a><span class="co"># create color map</span></span>
<span id="cb455-15"><a href="community.html#cb455-15" aria-hidden="true" tabindex="-1"></a>viridis <span class="op">=</span> cm.get_cmap(<span class="st">'viridis'</span>, <span class="bu">max</span>(communities) <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb455-16"><a href="community.html#cb455-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb455-17"><a href="community.html#cb455-17" aria-hidden="true" tabindex="-1"></a><span class="co"># visualize</span></span>
<span id="cb455-18"><a href="community.html#cb455-18" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">123</span>)</span>
<span id="cb455-19"><a href="community.html#cb455-19" aria-hidden="true" tabindex="-1"></a>nx.draw_spring(karate, labels <span class="op">=</span> nodelabels, cmap <span class="op">=</span> viridis,</span>
<span id="cb455-20"><a href="community.html#cb455-20" aria-hidden="true" tabindex="-1"></a>node_color <span class="op">=</span> communities, edge_color <span class="op">=</span> <span class="st">"grey"</span>)</span>
<span id="cb455-21"><a href="community.html#cb455-21" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:karate-py-conn"></span>
<img src="_main_files/figure-html/unnamed-chunk-89-1.png" alt="Best Louvain partition of the `karate` graph" width="614"><p class="caption">
Figure 8.7: Best Louvain partition of the <code>karate</code> graph
</p>
</div>
<div class="thinkahead">
<p><strong>Playing around:</strong> The options for community detection algorithms in the <code>cdlib</code> Python package are incredible. Consider playing around with some different algorithm. For example, you could try to visualize the community structure based on the Leiden algorithm. It’s also worth spending a little time exploring the technical documentation for the <code>cdlib</code> package<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="https://cdlib.readthedocs.io/en/latest" class="uri"&gt;https://cdlib.readthedocs.io/en/latest&lt;/a&gt;&lt;/p&gt;'><sup>55</sup></a>.</p>
</div>
</div>
<div id="finding-cliques-in-python" class="section level3" number="8.3.3">
<h3>
<span class="header-section-number">8.3.3</span> Finding cliques in Python<a class="anchor" aria-label="anchor" href="#finding-cliques-in-python"><i class="fas fa-link"></i></a>
</h3>
<p>All maximal cliques in a graph can be calculated using the <code>find_cliques()</code> function:</p>
<div class="sourceCode" id="cb456"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb456-1"><a href="community.html#cb456-1" aria-hidden="true" tabindex="-1"></a>cliques <span class="op">=</span> nx.find_cliques(karate)</span>
<span id="cb456-2"><a href="community.html#cb456-2" aria-hidden="true" tabindex="-1"></a>maximal_cliques <span class="op">=</span> <span class="bu">sorted</span>(cliques, key <span class="op">=</span> <span class="bu">len</span>)</span>
<span id="cb456-3"><a href="community.html#cb456-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb456-4"><a href="community.html#cb456-4" aria-hidden="true" tabindex="-1"></a><span class="co"># get number of maximal cliques</span></span>
<span id="cb456-5"><a href="community.html#cb456-5" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(maximal_cliques)</span></code></pre></div>
<pre><code>## 36</code></pre>
<div class="sourceCode" id="cb458"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb458-1"><a href="community.html#cb458-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get largest clique</span></span>
<span id="cb458-2"><a href="community.html#cb458-2" aria-hidden="true" tabindex="-1"></a>maximal_cliques[<span class="bu">len</span>(maximal_cliques) <span class="op">-</span> <span class="dv">1</span>]</span></code></pre></div>
<pre><code>## ['Actor 3', 'Mr Hi', 'Actor 14', 'Actor 2', 'Actor 4']</code></pre>
<p>Alternatively there are functions that can calculate the number of cliques, the size of the largest clique, and can extract the graph of the largest clique.</p>
<div class="sourceCode" id="cb460"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb460-1"><a href="community.html#cb460-1" aria-hidden="true" tabindex="-1"></a>nx.graph_number_of_cliques(karate)</span></code></pre></div>
<pre><code>## 36</code></pre>
<div class="sourceCode" id="cb462"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb462-1"><a href="community.html#cb462-1" aria-hidden="true" tabindex="-1"></a>nx.graph_clique_number(karate)</span></code></pre></div>
<pre><code>## 5</code></pre>
</div>
</div>
<div id="examples-of-uses" class="section level2" number="8.4">
<h2>
<span class="header-section-number">8.4</span> Examples of uses<a class="anchor" aria-label="anchor" href="#examples-of-uses"><i class="fas fa-link"></i></a>
</h2>

</div>
</div>

  <div class="chapter-nav">
<div class="prev"><a href="vertex-importance.html"><span class="header-section-number">7</span> Vertex Importance and Centrality</a></div>
<div class="next"><a href="similarity.html"><span class="header-section-number">9</span> Commonality and Assortativity</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#community"><span class="header-section-number">8</span> Components, Communities and Cliques</a></li>
<li>
<a class="nav-link" href="#theory-of-components-partitions-and-clusters"><span class="header-section-number">8.1</span> Theory of components, partitions and clusters</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#connected-components-of-graphs"><span class="header-section-number">8.1.1</span> Connected components of graphs</a></li>
<li><a class="nav-link" href="#vertex-partitioning"><span class="header-section-number">8.1.2</span> Vertex partitioning</a></li>
<li><a class="nav-link" href="#vertex-clustering-and-community-detection"><span class="header-section-number">8.1.3</span> Vertex clustering and community detection</a></li>
<li><a class="nav-link" href="#cliques"><span class="header-section-number">8.1.4</span> Cliques</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#finding-components-communities-and-cliques-using-r"><span class="header-section-number">8.2</span> Finding components, communities and cliques using R</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#finding-connected-components-of-disconnected-graphs"><span class="header-section-number">8.2.1</span> Finding connected components of disconnected graphs</a></li>
<li><a class="nav-link" href="#partioning-and-community-detection-in-r"><span class="header-section-number">8.2.2</span> Partioning and community detection in R</a></li>
<li><a class="nav-link" href="#finding-cliques-in-r"><span class="header-section-number">8.2.3</span> Finding cliques in R</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#finding-components-communities-and-cliques-using-python"><span class="header-section-number">8.3</span> Finding components, communities and cliques using Python</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#finding-components-using-python"><span class="header-section-number">8.3.1</span> Finding components using Python</a></li>
<li><a class="nav-link" href="#partitioning-and-community-detection-using-python"><span class="header-section-number">8.3.2</span> Partitioning and community detection using Python</a></li>
<li><a class="nav-link" href="#finding-cliques-in-python"><span class="header-section-number">8.3.3</span> Finding cliques in Python</a></li>
</ul>
</li>
<li><a class="nav-link" href="#examples-of-uses"><span class="header-section-number">8.4</span> Examples of uses</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/keithmcnulty/ona_book/blob/master/r/08-segmentation.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/keithmcnulty/ona_book/edit/master/r/08-segmentation.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Handbook of Graphs and Networks in People Analytics</strong>: With Examples in R and Python" was written by Keith McNulty. </p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
